async function sendMessage() {
    const input = document.getElementById('userInput');
    const chatBox = document.getElementById('chat-box');
    const userText = input.value;
    if (!userText) return;

    chatBox.innerHTML += `<p><b>Tú:</b> ${userText}</p>`;
    input.value = '';

    // 1. REEMPLAZA CON LA CLAVE DEL PROYECTO NUEVO
    const API_KEY = 'AIzaSyB1HcjdHQBedOOBE09_3w9l3nud3d-WKNk'; 
    const URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-lite:generateContent?key=${API_KEY}`;

    try {
        const response = await fetch(URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                contents: [{ parts: [{ text: userText }] }]
            })
        });

        const data = await response.json();

        if (response.status === 200 && data.candidates) {
            const aiResponse = data.candidates[0].content.parts[0].text;
            chatBox.innerHTML += `<p><b>IA:</b> ${aiResponse}</p>`;
        } else {
            // DIAGNÓSTICO DETALLADO:
            const errorCode = response.status;
            const errorMsg = data.error ? data.error.message : "Error sin mensaje";
            const errorStatus = data.error ? data.error.status : "Sin status";
            
            chatBox.innerHTML += `<div style="color:red; background:#fee; padding:10px; border:1px solid red;">
                <b>Error de Google ${errorCode}:</b><br>
                Status: ${errorStatus}<br>
                Mensaje: ${errorMsg}
            </div>`;
        }
    } catch (error) {
        chatBox.innerHTML += `<p style="color:red"><b>Error de Red:</b> ${error.message}</p>`;
    }
    chatBox.scrollTop = chatBox.scrollHeight;
}
