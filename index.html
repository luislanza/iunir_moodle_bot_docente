<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <style>
        body { margin: 0; font-family: Arial, sans-serif; font-size: 14px; background: transparent; }
        #chat-container { border: 1px solid #ccc; border-radius: 8px; overflow: hidden; display: flex; flex-direction: column; height: 400px; background: #fff; }
        #messages { flex-grow: 1; overflow-y: auto; padding: 10px; background: #fdfdfd; }
        .input-box { display: flex; border-top: 1px solid #eee; padding: 5px; }
        input { flex-grow: 1; border: none; padding: 10px; outline: none; }
        button { background: #007bff; color: white; border: none; padding: 10px 15px; cursor: pointer; border-radius: 4px; }
        .msg { margin-bottom: 8px; line-height: 1.4; }
    </style>
</head>
<body>
    <div id="chat-container">
        <div id="messages"></div>
        <div class="input-box">
            <input type="text" id="userInput" placeholder="Pregunta algo sobre Moodle...">
            <button onclick="enviar()">Enviar</button>
        </div>
    </div>

    <script>
        async function enviar() {
            const input = document.getElementById('userInput');
            const messages = document.getElementById('messages');
            const prompt = input.value.trim();
            if (!prompt) return;

            messages.innerHTML += `<div class="msg"><b>Tú:</b> ${prompt}</div>`;
            input.value = "";

            const KEY = 'AIzaSyBbCurPT8rS8Q5yasHN-EHtv57NwEFE3OE'; // Tu clave de hoy
            const URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-lite:generateContent?key=${KEY}`;

            try {
                const res = await fetch(URL, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });
                const data = await res.json();
                
                if (data.candidates) {
                    const respuesta = data.candidates[0].content.parts[0].text;
                    messages.innerHTML += `<div class="msg"><b>Bot:</b> ${respuesta}</div>`;
                } else {
                    messages.innerHTML += `<div class="msg" style="color:red">Error: ${data.error.message}</div>`;
                }
            } catch (e) {
                messages.innerHTML += `<div class="msg" style="color:red">Error de conexión.</div>`;
            }
            messages.scrollTop = messages.scrollHeight;
        }
    </script>
</body>
</html>
